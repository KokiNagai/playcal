<% set_meta_tags title: "投稿" %>
<div class="main-pref">
  <div class="post-show-top">
    <h2><i class="fa fa-tags"></i>投稿情報の詳細</h2>
  </div>


  <div class="post-show-wrapper">
    <div class="post-recrut-label">
      <% if @post.term == true %>
      <p id="post-recrut-label">募集中</p>
      <% elsif @post.term == false %>
      <p id="post-recrut-label1">募集は終了しました</p>
      <% end %>
    </div>
    <div class="post-show-upper">
      <div class="post-show-user">
        <% if @post.user.picture.present? %>
        <p><%= image_tag(@post.user.picture_url, class: "post-showr-picture" ) %></p>
        <% else %>
        <p><%= image_tag('blank-profile-picture-973460_1280.png', class: "post-showr-picture" ) %></p>
        <% end %>
        <p><%= link_to(@room.post.user.name.truncate(8), @room.post.user) %></p>
      </div>
      <div class="post-show-title">
        <p><%= @post.title.truncate(25) %></p>
      </div>
      <div class="post-delete">
        <% if @post.user == current_user %>
        <%= link_to @post, method: :delete, data: { confirm: '削除しますか？' } do %>
          <p><i class="fa fa-trash-o"></i></p>
        <% end %>
        <% end %>
      </div>
    </div>
    <div class="post-show-under-title">
      <h2>基本情報</h2>
    </div>
    <div class="post-show-under">
      <div class="post-show-under-left">
        <p><label>都道府県</label></br class="visible-xs"><%= @post.prefecture %></p>
        <p><label>地域名の詳細</label></br class="visible-xs"><%= @post.city %></p>
        <p><label>希望する技術レベル</label></br class="visible-xs"><%= @post.skill %></p>
      </div>
      <div class="post-show-under-right">
        <p><label>練習希望日</label></br class="visible-xs"><%= @post.playday %></p>
        <p><label>希望する性別</label></br class="visible-xs"><%= @post.gender %></p>
        <p><label>希望する人数</label></br class="visible-xs"><%= @post.member %></p>
        <p><label>練習の内容</label></br class="visible-xs"><%= @post.style %></p>
      </div>
    </div>
    <div class="post-show-under-title">
      <h2>募集内容の詳細</h2>
    </div>
    <div class="post-show-under-content">
      <p><%= @post.content %></p>
    </div>
  </div>

<% if @post.user != current_user %>
  <div class="like-wrapper">
    <div class="like-star">
      <% if Like.find_by(user_id: current_user.id, post_id: @post.id).present? %>
      <p>お気に入りを解除</p>
      <%= link_to("/likes/#{@post.id}/destroy", {method: "post"}) do %>
      <i class="fa fa-star fa-2x btn-star"></i>
      <% end %>
      <% elsif Like.find_by(user_id: current_user.id, post_id: @post.id).blank? && @post.term == true%>
      <p>お気に入りに追加</p>
      <%= link_to("/likes/#{@post.id}/create", {method: "post"}) do %>
      <i class="fa fa-star-o fa-2x btn-nonstar"></i></p>
      <% end %>
      <% end %>
    </div>
  </div>
  <% end %>

  <div class="post-end">
    <% if @post.user == current_user && @post.term == true %>
    <%= link_to "/posts/#{@post.id}/post_end", data: {confirm: "投稿を終了しますか？ 一度締め切ると再び表示することは出来なくなります。"} do %>
    <p id="post-end">募集を締め切る</p>
    <% end %>
    <% elsif @post.user == current_user && @post.term == false %>
    <p id="post-end1">募集は終了しました</p>
    <% end %>
  </div>

  <% post = @post.comments %>
  <% if current_user != @user  && @post.rooms.where(from_id: current_user.id).empty? && @post.term == true %>
  <%= form_for(@room) do |f| %>
  <%= f.hidden_field :post_id, :value => @post.id %>
  <%= f.hidden_field :to_id, :value => @user.id %>
  <%= f.hidden_field :from_id, :value => current_user.id %>
  <%= f.hidden_field :user_id, :value => current_user.id %>
  <div class="post-message-submit">
    <%= f.submit "メッセージを送る", class: "btn btn-success" %>
  </div>
  <% end %>
  <% elsif current_user == @user %>
  <div class="post-message-check">
    <%= link_to("メッセージボックスで確認する", "/inbox", class: "btn btn-success", id: "post-message-check") %>
  </div>
  <% elsif @post.rooms.where(from_id: current_user.id).present? %>
  <% room = @post.rooms.find_by(from_id: current_user.id) %>
  <div class="post-message-back">
    <%= link_to("以前のメッセージへ戻る", "/rooms/#{room.id}", class: "btn btn-success", id: "post-message-check") %>
  </div>
  <% end %>
 </div>

  </div>
 </div>
